---
import Icon from './Icon.astro';
import { getT, localePrefix } from '../i18n';
import type { Locale } from '../i18n';
import es from '../i18n/es.json';
import en from '../i18n/en.json';
import pt from '../i18n/pt.json';

interface Props {
  lang?: Locale;
}

const { lang = 'es' } = Astro.props;
const dict = lang === 'en' ? en : lang === 'pt' ? pt : es;
const t = getT(dict);
const basePath = localePrefix(lang);

const options = [
  { id: 'option1', label: t('quiz.option1Label') },
  { id: 'option2', label: t('quiz.option2Label') },
  { id: 'option3', label: t('quiz.option3Label') },
  { id: 'option4', label: t('quiz.option4Label') }
];

const resultsData = {
  option1: { info: t('quiz.option1Info'), title: t('quiz.option1Title'), description: t('quiz.option1Desc'), link: `${basePath}/soluciones/cloud-migration` },
  option2: { info: t('quiz.option2Info'), title: t('quiz.option2Title'), description: t('quiz.option2Desc'), link: `${basePath}/soluciones/cloud-security` },
  option3: { info: t('quiz.option3Info'), title: t('quiz.option3Title'), description: t('quiz.option3Desc'), link: `${basePath}/soluciones/data-management` },
  option4: { info: t('quiz.option4Info'), title: t('quiz.option4Title'), description: t('quiz.option4Desc'), link: `${basePath}/soluciones/ai-solutions` }
};
---

<section class="quiz-section">
  <script type="application/json" id="quiz-results-data" set:html={JSON.stringify(resultsData)}></script>
  <div class="quiz-container">
    <div class="quiz-card">
      <div class="quiz-left">
        <p class="quiz-intro">{t('quiz.intro')}</p>
        <h2 class="quiz-title">
          {t('quiz.titleLine1')}<br>
          {t('quiz.titleLine2')}
        </h2>
      </div>

      <div class="quiz-right" id="quiz-right">
        <div class="quiz-selection-wrapper">
          <div class="quiz-questions-column">
            <h3 class="quiz-question">{t('quiz.question')}</h3>
            
            <div class="quiz-options">
              {options.map((option) => (
                <label class="quiz-option" data-option-id={option.id}>
                  <input 
                    type="radio" 
                    name="quiz" 
                    value={option.id}
                    class="quiz-radio"
                  />
                  <span class="quiz-checkbox">
                    <Icon name="check" size={18} class="check-icon" />
                  </span>
                  <span class="quiz-label-text">{option.label}</span>
                </label>
              ))}
            </div>
          </div>

          <div class="quiz-result" id="quiz-result">
            <div class="result-content">
              <p class="result-info">
                {resultsData.option3.info}
              </p>
              
              <p class="result-recommendation">{t('quiz.recommendation')}</p>
              <h4 class="result-solution-title">{resultsData.option3.title}</h4>
              <p class="result-solution-desc">{resultsData.option3.description}</p>
              
              <a href={resultsData.option3.link} class="btn btn-primary" id="quiz-result-btn">
                {t('quiz.btnExplore')}
                <Icon name="north_east" size={20} />
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .quiz-section {
    width: 100%;
    background-color: var(--neutral-200);
    padding: 64px 0;
  }

  .quiz-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 40px;
  }

  .quiz-card {
    background-image: url('/images/quiz_bg.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-color: var(--neutral-100);
    border-radius: 24px;
    padding: 80px 60px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    position: relative;
    overflow: hidden;
    transition: all 0.5s ease;
  }

  .quiz-card.has-selection {
    grid-template-columns: 1fr 1fr;
  }

  .quiz-left {
    display: flex;
    flex-direction: column;
    justify-content: center;
    position: relative;
    transition: all 0.5s ease;
  }

  .quiz-card.has-selection .quiz-left {
    opacity: 0;
    visibility: hidden;
    position: absolute;
    pointer-events: none;
  }

  .quiz-intro {
    font-size: 16px;
    font-weight: 400;
    color: var(--neutral-700);
    margin-bottom: 1rem;
  }

  .quiz-title {
    font-size: 48px;
    font-weight: 700;
    color: var(--neutral-800);
    line-height: 1.2;
    margin-bottom: 2rem;
  }

  .quiz-right {
    display: flex;
    flex-direction: column;
    transition: all 0.5s ease;
  }

  .quiz-card.has-selection .quiz-right {
    grid-column: 1 / -1;
  }

  .quiz-selection-wrapper {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    transition: all 0.5s ease;
  }

  .quiz-card.has-selection .quiz-selection-wrapper {
    flex-direction: row;
    gap: 3rem;
  }

  .quiz-questions-column {
    flex: 1;
    transition: all 0.5s ease;
  }

  .quiz-question {
    font-size: 32px;
    font-weight: 700;
    color: var(--neutral-800);
    margin-bottom: 2rem;
    text-align: center;
    transition: all 0.5s ease;
  }

  .quiz-card.has-selection .quiz-question {
    text-align: left;
    font-size: 28px;
  }

  .quiz-options {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .quiz-option {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.25rem 1.5rem;
    background: var(--neutral-100);
    border: 2px solid var(--neutral-300);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
  }

  .quiz-option:hover {
    border-color: var(--neutral-400);
    background: var(--neutral-200);
  }

  .quiz-option.selected {
    border: 3px solid #00C19F;
    background: var(--neutral-100);
  }

  .quiz-radio {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }

  .quiz-checkbox {
    width: 24px;
    height: 24px;
    border: 2px solid var(--neutral-500);
    border-radius: 4px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    position: relative;
  }

  .quiz-checkbox :global(.icon) {
    display: none;
    color: var(--neutral-800);
  }

  .quiz-option.selected .quiz-checkbox {
    background: var(--neutral-100);
    border-color: var(--neutral-500);
  }

  .quiz-option.selected .quiz-checkbox :global(.icon) {
    display: block;
  }

  .quiz-label-text {
    font-size: 18px;
    font-weight: 400;
    color: var(--neutral-800);
    flex: 1;
  }

  .quiz-result {
    display: none;
    opacity: 0;
    flex: 1;
    transition: all 0.5s ease;
  }

  .quiz-result.visible {
    display: block;
    opacity: 1;
  }

  .result-content {
    background: var(--neutral-100);
    border-radius: 12px;
    padding: 2rem;
    border: 1px solid var(--neutral-300);
  }

  .result-info {
    font-size: 16px;
    font-weight: 400;
    color: var(--neutral-800);
    line-height: 1.6;
    margin-bottom: 56px;
  }

  .result-recommendation {
    font-size: 20px;
    font-weight: 500;
    color: var(--neutral-800);
    margin-bottom: 0.5rem;
  }

  .result-solution-title {
    font-size: 32px;
    font-weight: 700;
    color: var(--neutral-800);
    margin-bottom: 0.5rem;
  }

  .result-solution-desc {
    font-size: 16px;
    font-weight: 400;
    color: var(--neutral-800);
    margin-bottom: 42px;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .quiz-section {
      padding: 48px 0;
    }

    .quiz-container {
      padding: 0 30px;
    }

    .quiz-card {
      grid-template-columns: 1fr;
      gap: 3rem;
      padding: 60px 40px;
    }

    .quiz-title {
      font-size: 36px;
    }

    .quiz-question {
      font-size: 28px;
    }
  }

  @media (max-width: 768px) {
    .quiz-section {
      padding: 40px 0;
    }

    .quiz-intro,
    .result-info,
    .result-recommendation,
    .result-solution-desc {
      line-height: 1.2;
    }

    .quiz-container {
      padding: 0 20px;
    }

    .quiz-card {
      padding: 40px 30px;
      gap: 2rem;
    }

    .quiz-title {
      font-size: 32px;
      line-height: 1.2;
    }

    .quiz-question {
      font-size: 24px;
      line-height: 1.2;
    }

    .quiz-card.has-selection .quiz-question {
      font-size: 22px;
      line-height: 1.2;
    }

    .quiz-card.has-selection .quiz-selection-wrapper {
      flex-direction: column;
      gap: 2rem;
    }

    .quiz-card.has-selection {
      grid-template-columns: 1fr;
    }

    .quiz-option {
      padding: 1rem;
    }

    .quiz-label-text {
      font-size: 16px;
      line-height: 1.2;
    }

    .result-solution-title {
      font-size: 24px;
      line-height: 1.2;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const options = document.querySelectorAll('.quiz-option');
    const result = document.getElementById('quiz-result');
    const quizCard = document.querySelector('.quiz-card');
    const resultBtn = document.getElementById('quiz-result-btn') as HTMLAnchorElement | null;
    const dataEl = document.getElementById('quiz-results-data');
    const resultsData: Record<string, { info: string; title: string; description: string; link: string }> = dataEl ? JSON.parse(dataEl.textContent || '{}') : {};

    options.forEach(option => {
      const input = option.querySelector('input');

      option.addEventListener('click', () => {
        options.forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
        if (input) input.checked = true;

        const optionId = option.getAttribute('data-option-id');
        if (result && optionId && resultsData[optionId]) {
          const resultInfo = result.querySelector('.result-info');
          const resultTitle = result.querySelector('.result-solution-title');
          const resultDesc = result.querySelector('.result-solution-desc');
          if (resultInfo) resultInfo.textContent = resultsData[optionId].info;
          if (resultTitle) resultTitle.textContent = resultsData[optionId].title;
          if (resultDesc) resultDesc.textContent = resultsData[optionId].description;
          if (resultBtn) resultBtn.href = resultsData[optionId].link;
        }

        if (result && quizCard) {
          result.classList.add('visible');
          quizCard.classList.add('has-selection');
        }
      });
    });
  });
</script>

